**浏览器缓存机制详解**

浏览器缓存是web性能优化的核心手段之一，它通过存储资源副本减少网络请求，显著提升页面加载速度和 降低服务器压力；以下是浏览器缓存的完整解析：

**一、缓存类型与流程**

浏览器缓存分为四级，按优先级从高到低依次生效。
- Service Worker 缓存， 特点是可编程控制的缓存策略、独立于浏览器内置缓存系统；流程如下：
```
// sw.js 示例：拦截请求并返回缓存
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request).then(response => {
      return response || fetch(event.request);
    })
  );
});
```
- Memory Cache（内存缓存），
   - 特点是 短期存储当前会话的高频资源（如CSS、JS、图片），随着进程关闭而销毁，读取速度最快；
   - 策略是 小文件优先存入，页面刷新时可能保留，但导航跳转时可能失效；
- DIsk Cache（硬盘缓存），
   - 特点是持久化存储大文件、受http缓存头控制；
   - 存储位置：Chrome: ~/Library/Caches/Google/Chrome (Mac)，Firefox: ~/Library/Caches/Firefox (Mac)
 
- Push Cache（HTTP/2推送缓存）
   - 特点：存储HTTP/2 Server Push的资源；会话级缓存（关闭页面即失效）；优先级最低，其他缓存未命中时使用。
 
**二、HTTP缓存控制头**
- 1、强缓存（无请求）
   - 通过以下响应头控制
    ```
    Cache-Control: max-age=3600      # 资源有效期（秒）
    Expires: Wed, 21 Oct 2025 07:28:00 GMT  # 过期时间（HTTP/1.0遗留）
    ```
   - 生效条件：当前时间 < Expires 或 max-age未过期
   - 典型场景：静态资源（如logo.png?v=1.0）
 
- 2、协商缓存（有条件请求）
   - 当强缓存失效时触发，通过以下头验证：
    ```
    # 响应头（服务器返回）
    Last-Modified: Fri, 01 Jan 2021 00:00:00 GMT
    ETag: "33a64df551425fcc55e4d42a148795d9"
    
    # 请求头（浏览器发送）
    If-Modified-Since: Fri, 01 Jan 2021 00:00:00 GMT
    If-None-Match: "33a64df551425fcc55e4d42a148795d9"
    ```
   - 流程：服务器比对ETag或Last-Modified，若未变化返回304 Not Modified；若变化则返回200和新资源。



