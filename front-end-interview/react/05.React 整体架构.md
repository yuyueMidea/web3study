> 是否了解过 React 的架构？新的 Fiber 架构相较于之前的 Stack 架构有什么优势？

React的架构经历了重大变革：从Stack Reconciler 发展到现在的Fiber架构，这一变化带来了显著的性能提升和功能增强。

**一、传统Stack Reconciler架构**

**基本工作原理**
- 1、递归处理：采用深度优先递归的方式遍历虚拟dom树；
- 2、同步更新：一旦开始渲染过程就无法中断；
- 3、调用栈依赖：依赖JavaScript调用栈来管理更新流程；

**主要局限性**
- 阻塞主线程：大型应用更新会导致长时间占用主线程，造成界面卡顿；
- 无法中断：一旦开始渲染必须完成，无法响应更高优先级任务；
- 缺乏优先级：所有更新任务同等对待，无法实现任务分级；
- 动画不流畅：难以保证60FPS的流畅动画体验。

**二、Fiber架构的核心革新**

Fiber是React 16+ 的全新协调引擎，它重新实现了React的核心算法。

**核心概念**
- 1、Fiber节点：虚拟dom节点的扩展表示，包含更多元数据；
- 2、链表结构：用链表代替树结构，实现可中断遍历： child指向第一个子节点、sibling指向下一个兄弟节点、return指向父节点；
- 3、双缓存机制：current树：当前显示在屏幕上的树；workInProgress树：正在后台构建的树。

**三、Fiber架构的核心优势**
- 1、可中断与恢复的渲染过程：
   - 时间分片：将渲染工作分为小任务单元；
   - 增量渲染：在浏览器空闲时段执行任务（通过requestIdleCallback）；
   - 任务恢复：可以从上次中断的位置继续工作。

- 2、任务优先级调度
- 优先级分级：
   - 同步：最高优先级，如用户输入；
   - 任务：NextTick级别；
   - 动画：动画相关更新；
   - 高：用户交互结果；
   - 低：数据获取等后台任务；
   - 闲置：预渲染等。
 
- 基于优先级的更新。
- 3、并发渲染能力：并发模式（conCurrent mode）；可同时准备多个版本的UI，允许React在渲染过程中“暂停”以处理更高优先级事件。
- 4、更流畅的用户体验：
- 自动批处理：将多个状态更新合并为单个渲染；
- 过渡更新：通过startTransition 标记非紧急更新。
 
**四、Fiber架构的工作流程**
- 1、渲染阶段（可中断）；
   - 构建workInProgress树；
   - 执行组件渲染，计算变更；
   - 可被高优先级任务打断；
 
- 2、提交阶段（不可中断）；
   - 将计算出的变更应用到dom；
   - 执行生命周期和副作用；
   - 一次性完成确保UI一致性；

 **五、性能对比实测**
|指标	|Stack Reconciler	|Fiber 架构
|-----|-----------------|---------
|大型列表渲染时间	|500ms+	|200ms
|输入响应延迟	|明显	|几乎无感知
|动画帧率	30-45fps	|稳定60fps
|内存占用	|较低	|稍高

**六、Fiber带来的新特性**
- 1、Suspense：更优雅的异步加载处理；
- 2、Transition API：区分紧急与非紧急更新；
- 3、Offscreen API：后台预渲染；




